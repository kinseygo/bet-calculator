<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æŠ•æ³¨è®¡ç®—å™¨ v15</title>
<style>
body {
  font-family: "Segoe UI", "PingFang SC", sans-serif;
  background: #f5f7fa;
  color: #333;
  margin: 0;
  padding: 0;
}
header {
  background: linear-gradient(to right, #0a74da, #b70000);
  color: white;
  padding: 10px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}
button {
  margin: 4px;
  padding: 6px 10px;
  font-size: 14px;
}
#controls, #summary, #sortSection {
  padding: 10px;
  text-align: center;
  background: #fff;
  margin-bottom: 8px;
  border-bottom: 1px solid #ccc;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 6px;
  padding: 10px;
}
.cell {
  background: #fff;
  padding: 6px;
  border-radius: 6px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  text-align: center;
}
.cell input {
  width: 90%;
  text-align: center;
  font-size: 14px;
  padding: 4px;
}
.result {
  font-weight: bold;
}
.red { color: red; }
.blue { color: blue; }
.black { color: black; }
#adjustSection, #rankSection {
  padding: 10px;
  background: #fff;
  margin: 8px;
  border-radius: 6px;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #ccc;
  padding: 4px;
  text-align: center;
}
</style>
</head>
<body>
<header>ğŸ¯ æŠ•æ³¨è®¡ç®—å™¨ v15</header>

<!-- åŠŸèƒ½åŒº -->
<div id="controls">
  <button onclick="randomFill()">éšæœºå¡«å€¼</button>
  <button onclick="saveData()">ä¿å­˜</button>
  <button onclick="importData()">å¯¼å…¥</button>
  <button onclick="exportData()">å¯¼å‡º</button>
  <button onclick="restore()">æ¢å¤</button>
  å€æ•°ï¼š
  <select id="multiplier" onchange="calculateAll()">
    ${[...Array(21)].map((_,i)=>40+i).map(v=>`<option value="${v}" ${v==45?"selected":""}>${v}</option>`).join('')}
  </select>
</div>

<!-- æ±‡æ€»åŒº -->
<div id="summary">
  <span id="sumAll">æ€»å’Œ: 0</span> |
  <span id="profitCount">ç›ˆ: 0</span> |
  <span id="lossCount">äº: 0</span> |
  <span id="adjSum">è°ƒèŠ‚æ€»å’Œ: 0</span>
</div>

<!-- ä¸»è®¡ç®—åŒº -->
<div class="grid" id="mainGrid"></div>

<!-- è°ƒèŠ‚åŒº -->
<div id="adjustSection">
  <h3>ğŸ”§ è°ƒèŠ‚åŒºï¼ˆå‰20é¡¹ï¼‰</h3>
  <table id="adjustTable"><tr><th>ç¼–å·</th><th>åŸå€¼</th><th>è°ƒèŠ‚å€¼</th><th>è°ƒèŠ‚åç›ˆäº</th></tr></table>
</div>

<!-- å®æ—¶æ’åˆ—åŒº -->
<div id="rankSection">
  <h3>ğŸ“ˆ å®æ—¶æ’åˆ—åŒº</h3>
  æ’åºæ–¹å¼ï¼š
  <select id="sortType" onchange="updateRankTable()">
    <option value="profit">æŒ‰ç›ˆäºæ’åˆ—</option>
    <option value="adjusted">æŒ‰è°ƒèŠ‚åæ’åˆ—</option>
  </select>
  <table id="rankTable"><tr><th>ç¼–å·</th><th>åŸå€¼</th><th>ç›ˆäºå€¼</th><th>è°ƒèŠ‚åå€¼</th></tr></table>
</div>

<script>
const grid = document.getElementById('mainGrid');
let values = Array(49).fill(0);
let adjustValues = Array(49).fill(0);

function createGrid() {
  grid.innerHTML = '';
  for(let i=0;i<49;i++){
    const div=document.createElement('div');
    div.className='cell';
    div.innerHTML=`
      <div><strong>${(i+1).toString().padStart(2,'0')}</strong></div>
      <input id="input${i}" placeholder="è¾“å…¥æ•°å€¼æˆ–ç®—å¼" oninput="calculateAll()">
      <div id="calc${i}" class="result">0</div>
    `;
    grid.appendChild(div);
  }
}
createGrid();

function calculateAll(){
  for(let i=0;i<49;i++){
    const val = document.getElementById('input'+i).value;
    let num=0;
    try{ num = eval(val)||0; }catch(e){ num=0; }
    values[i]=num;
    document.getElementById('calc'+i).innerText=num;
  }
  const sumAll = values.reduce((a,b)=>a+b,0);
  document.getElementById('sumAll').innerText="æ€»å’Œ: "+sumAll.toFixed(2);

  const mult = Number(document.getElementById('multiplier').value);
  let profitCount=0,lossCount=0;
  for(let i=0;i<49;i++){
    const diff=sumAll-(values[i]*mult);
    const res=document.getElementById('calc'+i);
    res.innerText += " ("+(diff>0?"ç›ˆ":"äº")+")";
    res.className='result '+(diff>0?'blue':diff<0?'red':'black');
    if(diff>0) profitCount++; else if(diff<0) lossCount++;
  }
  document.getElementById('profitCount').innerText="ç›ˆ: "+profitCount;
  document.getElementById('lossCount').innerText="äº: "+lossCount;
  updateAdjust();
  updateRankTable();
}

function randomFill(){
  for(let i=0;i<49;i++){
    document.getElementById('input'+i).value=Math.floor(Math.random()*1000)+1;
  }
  calculateAll();
}

function updateAdjust(){
  const sortedIdx = values.map((v,i)=>[v,i]).sort((a,b)=>b[0]-a[0]).slice(0,20);
  const table=document.getElementById('adjustTable');
  table.innerHTML='<tr><th>ç¼–å·</th><th>åŸå€¼</th><th>è°ƒèŠ‚å€¼</th><th>è°ƒèŠ‚åç›ˆäº</th></tr>';
  const sumAll = values.reduce((a,b)=>a+b,0);
  const mult = Number(document.getElementById('multiplier').value);
  let adjSum=0;
  sortedIdx.forEach(([v,i])=>{
    const diff=sumAll-((v-adjustValues[i])*mult);
    adjSum+=v-adjustValues[i];
    table.innerHTML+=`
      <tr>
        <td>${(i+1).toString().padStart(2,'0')}</td>
        <td>${v}</td>
        <td><input type="number" value="${adjustValues[i]}" oninput="adjustValues[${i}]=Number(this.value);calculateAll()"></td>
        <td style="color:${diff>0?'blue':diff<0?'red':'black'}">${diff.toFixed(2)}</td>
      </tr>`;
  });
  document.getElementById('adjSum').innerText="è°ƒèŠ‚æ€»å’Œ: "+adjSum.toFixed(2);
}

function updateRankTable(){
  const type=document.getElementById('sortType').value;
  const sumAll=values.reduce((a,b)=>a+b,0);
  const mult=Number(document.getElementById('multiplier').value);
  const arr=values.map((v,i)=>{
    const adj=v-adjustValues[i];
    const diff=sumAll-(adj*mult);
    return {id:i+1,val:v,adj,diff};
  });
  arr.sort((a,b)=>type==='profit'?b.diff-a.diff:b.adj-a.adj);
  const table=document.getElementById('rankTable');
  table.innerHTML='<tr><th>ç¼–å·</th><th>åŸå€¼</th><th>ç›ˆäºå€¼</th><th>è°ƒèŠ‚åå€¼</th></tr>';
  arr.forEach(o=>{
    table.innerHTML+=`
      <tr>
        <td>${o.id.toString().padStart(2,'0')}</td>
        <td>${o.val}</td>
        <td style="color:${o.diff>0?'blue':o.diff<0?'red':'black'}">${o.diff.toFixed(2)}</td>
        <td>${o.adj}</td>
      </tr>`;
  });
}

function saveData(){
  localStorage.setItem('betCalcData',JSON.stringify({values,adjustValues}));
  alert('âœ… æ•°æ®å·²ä¿å­˜');
}
function restore(){
  localStorage.removeItem('betCalcData');
  location.reload();
}
function importData(){
  const txt=prompt('è¯·ç²˜è´´å¯¼å…¥çš„æ•°æ®ï¼š');
  try{
    const obj=JSON.parse(txt);
    values=obj.values;adjustValues=obj.adjustValues;
    values.forEach((v,i)=>document.getElementById('input'+i).value=v);
    calculateAll();
    alert('âœ… å¯¼å…¥æˆåŠŸ');
  }catch(e){alert('å¯¼å…¥å¤±è´¥');}
}
function exportData(){
  const data=JSON.stringify({values,adjustValues});
  const blob=new Blob([data],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download='bet-calculator-data.json';
  a.click();
}
window.onload=()=>{
  const saved=localStorage.getItem('betCalcData');
  if(saved){
    const obj=JSON.parse(saved);
    values=obj.values||values;
    adjustValues=obj.adjustValues||adjustValues;
    values.forEach((v,i)=>document.getElementById('input'+i).value=v);
  }
  calculateAll();
};
</script>
</body>
</html>
