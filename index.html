<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>投注计算器 v12.2（iPhone Web App版）</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 20px; background: #fff; color: #000; }
h1 { color: #003366; }
.container { display: flex; flex-wrap: wrap; gap: 4px; }
.item { width: 65px; display: flex; flex-direction: column; align-items: center; font-size: 12px; }
input { width: 60px; text-align: center; }
button { margin: 5px; }
#resultTable { width: 100%; border-collapse: collapse; margin-top: 15px; }
#resultTable th, #resultTable td { border: 1px solid #ccc; padding: 6px; text-align: center; }
#resultTable th { background: #f0f0f0; }
#totalSum { font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>
<h1>投注计算器 v12.2（iPhone Web App版）</h1>
<p>PWA 封装版：可添加到主屏幕使用。</p>

<div>
<button onclick="fillRandom()">随机填值(1–1000)</button>
<button onclick="clearAll()">清空输入</button>
<button onclick="exportCSV()">导出CSV</button>
<button onclick="sortValues()">按数值排序</button>
</div>

<p id="totalSum">当前总和：0</p>

<div class="container" id="inputsContainer"></div>

<table id="resultTable">
<thead><tr><th>编号</th><th>数值</th><th>差值</th></tr></thead>
<tbody id="resultBody"></tbody>
</table>

<script>
const container = document.getElementById("inputsContainer");
const resultBody = document.getElementById("resultBody");
const totalSumDisplay = document.getElementById("totalSum");

let data = Array(49).fill(0);

function createInputs() {
  for (let i = 1; i <= 49; i++) {
    const div = document.createElement("div");
    div.className = "item";
    const label = document.createElement("label");
    label.textContent = i;
    const input = document.createElement("input");
    input.type = "number";
    input.min = "0";
    input.value = "";
    input.oninput = () => update();
    div.appendChild(label);
    div.appendChild(input);
    container.appendChild(div);
  }
}

function update() {
  const inputs = container.querySelectorAll("input");
  data = Array.from(inputs).map(i => Number(i.value) || 0);
  const total = data.reduce((a,b)=>a+b,0);
  totalSumDisplay.textContent = "当前总和：" + total;
  const rows = data.map((v, idx) => {
    const diff = total - (v * 45);
    return { idx: idx + 1, value: v, diff };
  }).sort((a,b)=>b.value - a.value);
  renderTable(rows);
}

function renderTable(rows) {
  resultBody.innerHTML = "";
  for (const r of rows) {
    const tr = document.createElement("tr");
    const dColor = r.diff > 0 ? "blue" : r.diff < 0 ? "red" : "black";
    tr.innerHTML = `<td>${r.idx}</td><td>${r.value}</td><td style="color:${dColor}">${r.diff}</td>`;
    resultBody.appendChild(tr);
  }
}

function fillRandom() {
  const inputs = container.querySelectorAll("input");
  inputs.forEach(i => i.value = Math.floor(Math.random()*1000)+1);
  update();
}

function clearAll() {
  const inputs = container.querySelectorAll("input");
  inputs.forEach(i => i.value = "");
  update();
}

function exportCSV() {
  let csv = "编号,数值,差值\n";
  const rows = resultBody.querySelectorAll("tr");
  rows.forEach(r=>{
    const cols = r.querySelectorAll("td");
    csv += Array.from(cols).map(c=>c.textContent).join(",") + "\n";
  });
  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "投注计算结果.csv";
  a.click();
}

function sortValues() { update(); }

createInputs();
update();
</script>
</body>
</html>
